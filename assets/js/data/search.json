[ { "title": "Docker - Install Nginx Proxy Manager", "url": "/posts/docker-nginx-proxy-manager/", "categories": "docker", "tags": "nginx, hosting", "date": "2022-10-24 22:14:09 +0100", "snippet": "IntroInstall dockerWe will be running the Nginx Proxy Manager in docker stack. Hence, we will be needing a working docker installation. You can follow another one of my posts on Docker - Install and Configure.Set up Nginx Proxy ManagerCreate a new file docker-compose.yml file, please refer to the Nginx Proxy Manager documentation.Example Docker-Compose File:version: \"3\"services: app: image: \"jc21/nginx-proxy-manager:latest\" ports: - \"80:80\" - \"81:81\" - \"443:443\" environment: DB_MYSQL_HOST: \"db\" DB_MYSQL_PORT: 3306 DB_MYSQL_USER: \"npm\" DB_MYSQL_PASSWORD: \"npm\" DB_MYSQL_NAME: \"npm\" volumes: - ./data:/data - ./letsencrypt:/etc/letsencrypt db: image: \"jc21/mariadb-aria:latest\" environment: MYSQL_ROOT_PASSWORD: \"npm\" MYSQL_DATABASE: \"npm\" MYSQL_USER: \"npm\" MYSQL_PASSWORD: \"npm\" volumes: - ./data/mysql:/var/lib/mysqlStart the Nginx Proxy Managerdocker-compose up -dLogin to the web UI of NGINX proxy managerNow we can log in to the web UI. Simply use your browser to connect to your server by using the IP address or an FQDN and connect on port 81. Log in with the username admin@example.com and the password changeme. Next, you should change your username and password, and that’s it!" }, { "title": "Docker - Host a Demo CAS Server", "url": "/posts/docker-demo-cas-server/", "categories": "docker", "tags": "cas", "date": "2022-07-23 09:27:59 +0100", "snippet": "IntroObtain keystore fileIn order to host a Demo CAS server, first of all we will need to generate a trusted authority signed certificate which can be obtained by following my pervious post on Linux - Let’s Encrypt for Java Apps.Install dockerFurthermore, we will be running the Demo CAS Server in docker. Hence, we will be needing a working docker installation. You can follow another one of my posts on Docker - Install and Configure.Obtain the CAS docker imageIn this case, we are configuring our Demo CAS server to run on v6.4.0. In order to obtain this version you can use the following command:docker pull apereo/cas:6.4.0If you wish to run the latest version of the CAS server you can use the following command:docker pull apereo/cas:latestMake the shell script to run the docker container#!/usr/bin/env bashIFS=''cd -P \"$(dirname \"$0\")\"properties='{ \"management\": { \"endpoints\": { \"enabled-by-default\": true, \"web\": { \"exposure\": { \"include\": \"*\" } } } }, \"cas\": { \"authn\": { \"accept\": { \"users\": \"casuser::Mellon,casadmin::Mellon,harry::Vasanth\" }, \"attribute-repository\": { \"core\": { \"default-attributes-to-release\": [ \"first-name\", \"last-name\", \"email\" ] }, \"stub\": { \"attributes\": { \"cn\": \"CAS\", \"display-name\": \"Harry Vasanth\", \"uid\": \"harry\", \"first-name\": \"Harry\", \"last-name\": \"Vasanth\", \"email\": \"harry@harryvasanth.com\" }, \"id\": \"Static\", \"order\": \"0\" } } }, \"events\": { \"core\": { \"track-configuration-modifications\": false } }, \"monitor\": { \"endpoints\": { \"endpoint\": { \"defaults\": { \"access\": \"ANONYMOUS\" } } } }, \"server\": { \"name\": \"https://cas.harryvasanth.com:8444\", \"prefix\": \"https://cas.harryvasanth.com:8444/cas\", \"tomcat\": { \"http\": { \"enabled\": false } } }, \"service-registry\": { \"core\": { \"init-from-json\": true } } }}'properties=$(echo \"$properties\" | tr -d '[:space:]')echo -e \"*******************************\\nCAS Server properties\\n*******************************\"echo \"${properties}\" | jqdocker stop demo-cas-server || true &amp;&amp; docker rm demo-cas-server || trueecho -e \"Mapping CAS keystore in Docker container to '$(pwd)/cas.harryvasanth.com.keystore'\"docker run --rm -d \\ --mount type=bind,source=\"$(pwd)/cas.harryvasanth.com.keystore\",target=/etc/cas/thekeystore \\ -e SPRING_APPLICATION_JSON=\"${properties}\" \\ -p 8444:8443 --name demo-cas-server apereo/cas:6.4.0#docker logs -f demo-cas-server &amp;echo -e \"Waiting for CAS Server to Initialize...\"until curl -k -L --output /dev/null --silent --fail https://cas.harryvasanth.com:8444/cas/login; do echo -n . sleep 1doneecho -e \"\\nCAS Server is running on port 8444\"echo -e \"\\n\\n CAS Server is Ready!\" Change cas.harryvasanth.com with the FQDN of the desired CAS server." }, { "title": "Linux - Let's Encrypt for Java Apps", "url": "/posts/linux-lets-encrypt-java-apps/", "categories": "linux", "tags": "hosting", "date": "2022-07-22 19:12:22 +0100", "snippet": "IntroInstall certbot as mentioned in my previous post on Linux - Install Certbot.By default, certbot retrieves a certificate and installs it immediately on the web server by adding an extra parameter, eg. --apache for Apache HTTP Server. For the case of Docker - Demo CAS Server, it is just enough to retrieve only a certificate. This is done by adding the certonly parameter to the command as follows:certbot certonly You need to make sure that the TCP port 80 of the server is accessible from Let’s Encrypt servers and no other application is utilizing it.This will spin up a temporary server on TCP port 80 to validate the authority of the domain to issue the required certificates. The installed Let’s Encrypt certificates in the /etc/letsencrypt/live directory on the file system.Create Keystore fileTo use a certificate in a Java application, the preferred way is to add it to a separate .keystore file. The Java Runtime Environment (JRE) ships with a tool called keytool to create certificates and manipulate key stores. Adding certificates to a keystore can be done by using OpenSSL and the keytool.If the system doesn’t have JRE installed, you can install it by running the following command:sudo apt install default-jre jqArchive certificates to PKCS #12 fileImporting multiple public and private .pem certificates directly in a keystore is not supported by the keytool. Hence, it is necessary to add all .pem files to a PKCS 12 archive. This can be done by the OpenSSL tool with the following command:openssl pkcs12 -export \\\t -in /etc/letsencrypt/live/cas.harryvasanth.com/cert.pem \\\t -inkey /etc/letsencrypt/live/cas.harryvasanth.com/privkey.pem \\\t -out /tmp/cas.harryvasanth.com.p12 \\\t -name cas.harryvasanth.com \\\t -CAfile /etc/letsencrypt/live/cas.harryvasanth.com/fullchain.pem \\\t -caname \"Let's Encrypt Authority X3\" \\\t -password pass:changeit Change cas.harryvasanth.com with the custom FQDN of the target CAS server (or any Java application server).Import PKCS #12 archive to the Keystore fileThe next step is to import the certificates into a .keystore file.keytool -importkeystore \\\t-deststorepass changeit \\\t-destkeypass changeit \\\t-deststoretype pkcs12 \\\t-srckeystore /tmp/cas.harryvasanth.com.p12 \\\t-srcstoretype PKCS12 \\\t-srcstorepass changeit \\\t-destkeystore /tmp/cas.harryvasanth.com.keystore \\\t-alias cas.harryvasanth.comThe keystore at location /tmp/cas.harryvasanth.com.keystore can now be used by the CAS server (or any Java application server).Automate Keystore creationMake the shell script to create keystoreCreate a shell script /home/&lt;user.name&gt;/renew-cert-keystore.shHere is an example:touch /home/harry.vasanth/renew-cert-keystore.sh &amp;&amp; \\chmod +x /home/harry.vasanth/renew-cert-keystore.shAdd the following content to the script:#!/usr/bin/env bashIFS=''cd -P \"$(dirname \"$0\")\"# Create keystoreecho \"Refreshing '$(pwd)/cas.harryvasanth.com.keystore'\"openssl pkcs12 -export \\\t -in /etc/letsencrypt/live/cas.harryvasanth.com/cert.pem \\\t -inkey /etc/letsencrypt/live/cas.harryvasanth.com/privkey.pem \\\t -out /tmp/cas.harryvasanth.com.p12 \\\t -name cas.harryvasanth.com \\\t -CAfile /etc/letsencrypt/live/cas.harryvasanth.com/fullchain.pem \\\t -caname \"Let's Encrypt Authority X3\" \\\t -password pass:changeit# User Keytool to import P12 to Keystore formatkeytool -importkeystore \\\t-deststorepass changeit \\\t-destkeypass changeit \\\t-deststoretype pkcs12 \\\t-srckeystore /tmp/cas.harryvasanth.com.p12 \\\t-srcstoretype PKCS12 \\\t-srcstorepass changeit \\\t-destkeystore /tmp/cas.harryvasanth.com.keystore \\\t-alias cas.harryvasanth.com# Move certificates to the current directoryecho \"Copy '/tmp/cas.harryvasanth.com.keystore' to '$(pwd)/cas.harryvasanth.com.keystore'\"cp /tmp/cas.harryvasanth.com.keystore $(pwd)/cas.harryvasanth.com.keystoreSchedule the script to run periodicallyThe following line in crontab makes sure our script is executed every hour.0 * * * * yes | bash /home/&lt;user.name&gt;/renew-cert-keystore.sh &gt;&gt; /var/log/renew-cert-keystore.log" }, { "title": "Docker - Install and Configure", "url": "/posts/docker-install-configure/", "categories": "docker", "tags": "hosting", "date": "2022-07-21 12:01:20 +0100", "snippet": "InstallationThe Docker installation package available in the official Ubuntu repository may not be the latest version. To ensure we get the latest version, we’ll install Docker from the official Docker repository. To do that, we’ll add a new package source, add the GPG key from Docker to ensure the downloads are valid, and then install the package.First, install docker prerequisites:sudo apt updatesudo apt install apt-transport-https ca-certificates curl software-properties-common gnupgThen add the official Docker repository to APT sources and install docker:curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable\"sudo apt install docker-ceConfigurationIf you want to avoid typing sudo whenever you run the docker command, add your username to the docker group:sudo usermod -aG docker &lt;user.name&gt;" }, { "title": "GitHub - Source Repository Migations", "url": "/posts/github-repository-migration/", "categories": "github", "tags": "migration", "date": "2021-01-28 21:29:01 +0000", "snippet": "I have been looking for a way to migrate a private Git repository to GitHub without losing commit history.Using GIT Command Line Interface Create an empty GitHub repository. Clone the remote repository with the --bare option to obtain the clone with no working directory. git clone --bare https://&lt;GIT_SERVER_FQDN&gt;/&lt;USER_NAME&gt;/&lt;REPO_NAME&gt;.git The -- bare option represents that a repository will be cloned with the project’s history, which can be pushed and pulled from but not directly modified. Push the locally cloned repository to GitHub using the --mirror option. cd &lt;REPO_NAME&gt;.git git push --mirror https://github.com/&lt;USER_NAME&gt;/&lt;REPO_NAME&gt;.git This ensures that all the references to the cloned repository, such as branches and tags, are pushed. Using Shell ScriptIn order to facilitate any future needs of going through similar migrations I wrote a trivial shell script which bundles all the commands in the GIT CLI together into a single executable script.#!/bin/bashread -p \"Enter your orginial Git repository URL : \" reporead -p \"Enter target GitHub repository URL : \" newrepoIFS='/' read -a array &lt;&lt;&lt; \"$repo\"reponame = ${array[1]}git clone --bare $repocd $reponameecho $reponamegit push --mirror $newrepocd ..rm -rf $repoecho \"Done!\"" }, { "title": "GitHub - Jekyll: The Static Site Generator", "url": "/posts/github-jekyll/", "categories": "github", "tags": "jekyll, hosting", "date": "2021-01-21 20:21:21 +0000", "snippet": "Jekyll is a static site generator that transforms your plain text into beautiful static web sites and blogs. It can be use for a documentation site, a blog, an event site, or really any web site you like.Be sure to ⭐ the jekyll repo and the Chrirpy theme repoInstall Dependenciessudo apt updatesudo apt install ruby-full build-essential zlib1g-dev gitTo avoid installing RubyGems packages as the root user:If you are using bash (usually the default for most)echo '# Install Ruby Gems to ~/gems' &gt;&gt; ~/.bashrcecho 'export GEM_HOME=\"$HOME/gems\"' &gt;&gt; ~/.bashrcecho 'export PATH=\"$HOME/gems/bin:$PATH\"' &gt;&gt; ~/.bashrcsource ~/.bashrcIf you are using zsh (you know if you are)echo '# Install Ruby Gems to ~/gems' &gt;&gt; ~/.zshrcecho 'export GEM_HOME=\"$HOME/gems\"' &gt;&gt; ~/.zshrcecho 'export PATH=\"$HOME/gems/bin:$PATH\"' &gt;&gt; ~/.zshrcsource ~/.zshrcInstall Jekyll bundlergem install jekyll bundlerCreating a site based on Chirpy StarterVisit https://github.com/cotes2020/jekyll-theme-chirpy#quick-startAfter creating a site based on the template, clone your repogit clone git@&lt;YOUR-USER-NAME&gt;/&lt;YOUR-REPO-NAME&gt;.gitthen install your dependenciescd repo-namebundlebundle lock --add-platform x86_64-linuxAfter making changes to your site, commit and push then up to gitgit add .git commit -m \"feat(init): initial commit\"git pushJekyll Commandsserving your sitebundle exec jekyll sBuilding your site in production modeJEKYLL_ENV=production bundle exec jekyll bThis will output the production site to _siteBuilding with DockerCreate a Dockerfile with the followingFROM nginx:stable-alpineCOPY _site /usr/share/nginx/htmlBuild site in production modeJEKYLL_ENV=production bundle exec jekyll bThen build your image:docker build .Creating a PostNaming ConventionsJekyll uses a naming convention for pages and postsCreate a file in _posts with the formatYEAR-MONTH-DAY-title.mdFor example:2021-01-21-github-jekyll.md Jekyll can delay posts which have the date/time set for a point in the future determined by the “front matter” section at the top of your post file. Check the date &amp; time as well as time zone if you don’t see a post appear shortly after re-build.Local Linking of FilesImage from asset:... which is shown in the screenshot below:![A screenshot](/assets/screenshot.jpg)Linking to a file... you can [download the PDF](/assets/diagram.pdf) here.See more post formatting rules on the Jekyll siteMarkdown ExamplesIf you need some help with markdown, check out the markdown cheat sheetFor more neat syntax for the Chirpy theme check their demo page on making posts https://chirpy.cotes.page/posts/write-a-new-post/" }, { "title": "Linux - Mount An NFS Target", "url": "/posts/linux-mount-nfs-target/", "categories": "linux", "tags": "general", "date": "2017-10-29 17:55:22 +0000", "snippet": "InstallationFirst of all, we need to install the nfs-common dependencies:sudo apt install nfs-common -yThen we can list all available NFS targets from a remote server:sshowmount -e 192.168.1.10/mnt/nfs_pool_00/documents 192.168.1.10/mnt/nfs_pool_01/backups/images 192.168.1.10,10.10.1.10ConfigurationOnce we determine the appropriate mount, we can go ahead and create a local mounting point and mount the remote NFS location:sudo mkdir /mnt/documentssudo mount 192.168.1.10:/mnt/nfs_pool_00/documents /mnt/documentsVerificationFinally, we can verify if it’s mounted properly and writable:sudo df -hsudo mkdir /mnt/documents/miscsudo touch /mnt/documents/misc/test.txtsudo ls -la /mnt/documents/" }, { "title": "Linux - Redirect Ports Using IPTables", "url": "/posts/linux-redirect-ports-iptables/", "categories": "linux", "tags": "general", "date": "2017-08-04 23:28:56 +0100", "snippet": "In order to redirect ports, we need to add our rules in PREROUTING chain. So run below command:[root@harryvasanth.com ~]# iptables -t nat -A PREROUTING -i ens18 -p tcp --dport 80 -j REDIRECT --to-port 8080If we have an interface name other than ens18 then we need to edit we command accordingly. We can even add we source and destinations as well in same command using --src and --dst options. Without them, it’s assumed to any source and any destination.Check port redirection in iptableVerify port redirect rule in iptables using below command:[root@harryvasanth.com ~]# iptables -t nat -L -n -vChain PREROUTING (policy ACCEPT 1 packets, 30 bytes)pkts bytes target prot opt in out source destination84 5000 REDIRECT tcp -- ens18 * 0.0.0.0/0 0.0.0.0/0 tcp dpt:80 redir ports 8080We can see port 80 is being redirected to port 8080 on the server. Note here target is REDIRECT. Do not get confused with port redirection with port forwarding.Save IPTables rulesTo save iptables rules and make them persistent over reboots use the following command:[root@harryvasanth.com ~]# iptables-save" }, { "title": "Linux - Port Forward Using IPTables", "url": "/posts/linux-port-forward-iptables/", "categories": "linux", "tags": "general", "date": "2017-07-28 22:34:02 +0100", "snippet": "First of all, we need to check if port forwarding is enabled or not on our server. For better understanding, we will be using ens18 as a reference interface and all our command executions will be related to ens18 in this post.Check if port forwarding is enabled in LinuxEither we can use sysctl to check if forwarding is enabled or not. Use below command to check:[root@harryvasanth.com ~]# sysctl -a | grep -i ens18.forwardingnet.ipv4.conf.ens18.forwarding = 0net.ipv6.conf.ens18.forwarding = 0Since both values are zero, port forwarding is disabled for ipv4 and ipv6 on interface ens18.We can also use the process filesystem to check if port forwarding is enabled or not.[root@harryvasanth.com ~]# cat /proc/sys/net/ipv4/conf/ens18/forwarding0[root@harryvasanth.com ~]# cat /proc/sys/net/ipv6/conf/ens18/forwarding0Again here process FS with zero values confirms port forwarding is disabled on our system. Now we need to first enable port forwarding on our system then we will configure port forwarding rules in iptables.Enable port forwarding in LinuxAs we checked above, using the same methods we can enable port forwarding in Linux. But its recommended using sysctl command rather than replacing 0 by 1 in proc files.Enable port forwarding in Linux using sysctl command:[root@harryvasanth.com ~]# sysctl net.ipv4.conf.ens18.forwarding=1net.ipv4.conf.ens18.forwarding = 1[root@harryvasanth.com ~]# sysctl net.ipv6.conf.ens18.forwarding=1net.ipv6.conf.ens18.forwarding = 1To make it persistent over reboots, add parameters in /etc/sysctl.conf :[root@harryvasanth.com ~]# echo \"net.ipv4.conf.ens18.forwarding = 1\"&gt;&gt;/etc/sysctl.conf[root@harryvasanth.com ~]# echo \"net.ipv6.conf.ens18.forwarding = 1\"&gt;&gt;/etc/sysctl.conf[root@harryvasanth.com ~]# sysctl -pnet.ipv4.conf.ens18.forwarding = 1net.ipv6.conf.ens18.forwarding = 1Now, we have port forwarding enabled on our server, we can go ahead with configuring port forwarding rules using iptables.Forward ports in LinuxHere we will forward tcp port 80 to tcp port 8080 on 192.168.1.1. Do not get confused port forwarding with port redirection.We need to insert an entry in PREROUTING chain of iptables with DNAT target. Command will be as follows:iptables -A PREROUTING -t nat -i ens18 -p tcp --dport 80 -j DNAT --to 192.168.1.1:8080iptables -A FORWARD -p tcp -d 192.168.1.1 --dport 8080 -j ACCEPTChange interface, IP and ports as per our requirement. The first command tells us to redirect packets coming to port 80 to IP 192.168.1.1 on port 8080. Now packet also needs to go through FORWARD chain so we are allowing in in the second command. Now rules have been applied. We need to verify them.Check port forwarding IPTables rulesCommand to verify port forwarding rules is:[root@harryvasanth.com ~]# iptables -t nat -L -n -vChain PREROUTING (policy ACCEPT 1 packets, 30 bytes)pkts bytes target prot opt in out source destination 84 5000 REDIRECT tcp -- ens18 * 0.0.0.0/0 0.0.0.0/0 tcp dpt:80 to:192.168.1.1:8080Here REDIRECT target means it’s a redirection rule. Since we have configured the forwarding rule we see the target as DNAT.Save IPTables rulesTo save iptables rules and make them persistent over reboots use the following command:[root@harryvasanth.com ~]# iptables-save" }, { "title": "Mikrotik - Update Firmware", "url": "/posts/mikrotik-update-firmware/", "categories": "mikrotik", "tags": "router-os", "date": "2017-05-23 11:12:03 +0100", "snippet": "First of all setup eamil alerts to be sent regarding the new available updates:/tool e-mail set address=mail.harryvasanth.com from=harry@harryvasanth.com/system script add dont-require-permissions=no name=UpdateAlert owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source=\"/system package update\\r\\ \\ncheck-for-updates once\\r\\ \\n\\r\\ \\n:delay 3s;\\r\\ \\n\\r\\ \\n:if ( [get status] = \\\"New version is available\\\") do={ \\r\\ \\n\\r\\ \\n:local newVer [get latest-version]\\r\\ \\n/tool e-mail send to=\\\"harry@harryvasanth.com\\\" subject=\\\"New RouterOS firmware available for router \\$[/system identity get name]\\\" body=\\\"Upgrading RouterOS on router \\$[/system identity get name] from \\$[/system package update get installed-version] to \\$[/system package update get latest-version] (channel:\\$[/system package update get channel])\\\"\\r\\ \\n \\r\\ \\n}\\r\\ \\n\"Reference: LinkNow lets setup automated update: /system scheduler add name=UpgradeFirmware on-event=\"if ([/system routerboard get current-firmware] != [/system routerboard get upgrade-firmware]) do={\\r\\ \\n/system routerboard upgrade\\r\\ \\n:delay 1\\r\\ \\n/system reboot\\r\\ \\n}\\r\\ \\n\" policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive start-time=startupReference: LinkAdditionally, enable SNMP to be monitored by network monitoring software:/snmp set enabled=yes" }, { "title": "Mikrotik - Automate Backups", "url": "/posts/mikrotik-automate-backups/", "categories": "mikrotik", "tags": "router-os", "date": "2017-04-01 22:09:02 +0100", "snippet": "Why?It is useful to have both textual and binary backups since the textual backup (without sensitive data, such as passwords) can be read by a human to understand the router configuration, while the latter (binary) can be used to restore configuration (with sensitive data) with ease. However, the binary configuration is more prone to corruption.Schedule: Textual Backup/system scheduler add comment=\"Backup running config in textual format without sensitive data\" interval=1w name=runningConfigDump on-event=\"export file=/flash/mtikconf-nosensitive terse\" policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=apr/10/2000 start-time=12:00:00Schedule: Binary Backup/system scheduler add comment=\"Backup config as binary\" interval=1w name=binBackup on-event=\"system backup save name=/flash/mtikAP.backup\" policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=apr/10/2000 start-time=12:00:00Script: Email BackupsScript: Email the backup file with system resource and health report (can be scheduled to run periodically)#Local Strings:local rPrint [:tostr [/system resource print as-value]];:local hPrint [:tostr [/system health print as-value]];#Merged Strings:local strMerged (\"Resource: \\n\".$rPrint.\"\\n\\nHealth: \\n\".$hPrint);:local strSplit value=\"\";:if ([:find $strMerged \";\" -1] &gt; 0) do={ :for i from=0 to=([:len $strMerged] -1) step=1 do={ :local escapeChar value=[:pick $strMerged $i]; :if ($escapeChar = \";\") do={ :set escapeChar value=\"\\n\" }; :set strSplit value=($strSplit.$escapeChar); }}/tool e-mail send to=\"harry@harryvasanth.com\" subject=\"Router backup - $[/system identity get name] - $[/system clock get date]\" body=\"$strSplit\" file=mtik.backup" }, { "title": "Mikrotik - Mutiple SSID with CAPsMAN", "url": "/posts/mikrotik-capsman-multiple-ssid/", "categories": "mikrotik", "tags": "router-os", "date": "2017-03-31 09:49:22 +0100", "snippet": "Pre-requisitesThe ports on the switches where the APs are to be connected, should be configured with the following VLANs:VLAN 6 (HOME): not taggedVLAN 12 (HOME-Guest): taggedQuickset ModeIn this mode configure the following settings as follows:ConfigurationMode: BridgeSystemPassword: (enter new admin password)Press the Apply Configuration button.TerminalCAPs-Man Create appropriate CAPsMan datapath template /caps-man datapath add client-to-client-forwarding=yes local-forwarding=yes name=datapath-HOME vlan-id=6 vlan-mode=no-tag /caps-man datapath add client-to-client-forwarding=yes local-forwarding=yes name=datapath-Guest vlan-id=12 vlan-mode=use-tag Create appropriate CAPsMan security template /caps-man security add authentication-types=wpa-psk,wpa2-psk name=security-HOME passphrase=h0m3w1f1 /caps-man security add authentication-types=wpa-psk,wpa2-psk name=security-Guest passphrase=home-guest Create appropriate CAPsMan configurations /caps-man configuration add country=portugal datapath=datapath-HOME name=config-HOME security=security-HOME ssid=HOME /caps-man configuration add country=portugal datapath=datapath-Guest name=config-Guest security=security-Guest ssid=HOME-Guest We are going to create a single CAPsMAN provisioning rule to create the HOME and the HOME-Guest SSIDs on a single device, each connects CAP is going to create these SSIDs automatically. /caps-man provisioning add action=create-dynamic-enabled master-configuration=config-HOME slave-configurations=config-Guest Enable the CAPsMAN manager /caps-man manager set enabled=yes package-path=/ upgrade-policy=suggest-same-version Enable the Wireless of the AP to be managed by the CAP /interface wireless cap " }, { "title": "Mikrotik - Configure cAP", "url": "/posts/mikrotik-configure-cap/", "categories": "mikrotik", "tags": "router-os", "date": "2017-03-01 04:11:29 +0000", "snippet": "RequirementsRequirements are to have two WiFi networks, one with SSID HOME and connected to the Home VLAN (6), and a guest WiFI network, with SSID HOME-Guest and connected to the Guest VLAN (12).This example is based on Mikrotik cAP acInitial ConfigurationQuickset is a simple configuration wizard page that prepares your router in a few clicks. It is the first screen a user sees when opening the router in a web browser.Select Quickset Mode: WISP APIn this mode configure the following settings as follows:ConfigurationMode: BridgeWirelessWireless Protocol: (leave) 802.11Network Name: HOMEFrequency: (leave) autoBand: (leave) 5GHz-A/N/ACCannel Width: (leave) 20/40/80MHz CeeeCountry: portugalSecurity: WPA2Encryption: aes ccmWiFi Password: (enter wifi password)BridgeAddress Acquisition: staticIP address: 192.168.6.228Netmask: 255.255.255.0Gateway: 192.168.6.254DNS Servers: 192.168.6.230SystemPassword: (enter new admin password)Press the Apply Configuration button. We should have a working WiFi AP on the HOME network. However, the configuration is no complete. The configuration continues using WebFig and Terminal.Add necessary VLAN interfaces on ethernet interfaces to make them as VLAN trunk or access ports:add interface=ether1 name=eth2-vlan6 vlan-id=6add interface=ether1 name=eth1-vlan12 vlan-id=12add interface=ether2 name=eth2-vlan12 vlan-id=12Add bridges for each VLANadd name=bridge-vlan6add name=bridge-vlan12The Quickset configuration had set the IP address in ether2 interface, but since we have added bridges for each VLAN it is better (safer) to set the IP on the bridge bridge-vlan6.In WebFig add Security Profile for the HOME-Guest Wi-Fi network:Goto Wireless -&gt; Security Profiles and press the Add New to create a new profile.Name: home-guestMode: (leave) dynamic keysAuthentication Types: (leave) WPA PSK and WPA2 PSKUnicast Ciphers: (leave) aes ccmGroup Ciphers: (leave) aes ccmWPA Pre-Shared Key: h0m3w1f1WPA2 Pre-Shared Key: h0m3w1f1Press OK, to create new security profile.In WebFig add virtual wireless interfaces for the HOME-Guest Wi-Fi:Goto Wireless -&gt; WiFi Interfaces and press the Add New and select Virtual to create a new interface.Name: HOME-Guest-2GSSID: HOME-GuestMaster Interface: HOME-2GSecurity Profile: home-guestPress OK, to create new interface.Goto Wireless -&gt; WiFi Interfaces and press the Add New and select Virtual to create a new interface.Name: HOME-Guest-5GSSID: HOME-GuestMaster Interface: HOME-5GSecurity Profile: home-guestPress OK, to create new interface.Add VLAN interfaces to their corresponding bridges and ethernet interfaces where untagged traffic is necessary/interface bridge portadd bridge=bridge-vlan6 interface=ether1add bridge=bridge-vlan12 interface=eth1-vlan12add bridge=bridge-vlan12 interface=HOME-Guest-2G add bridge=bridge-vlan12 interface=HOME-Guest-5G" }, { "title": "Linux - Install Fail2ban", "url": "/posts/linux-install-fail2ban/", "categories": "linux", "tags": "hosting", "date": "2017-02-14 16:02:14 +0000", "snippet": "InstallationFirst, install Fail2ban using apt:sudo apt updatesudo apt install fail2banConfigurationThe default Fail2ban installation comes with two configuration files, /etc/fail2ban/jail.conf and /etc/fail2ban/jail.d/defaults-debian.conf. It is not recommended to modify these files as they may be overwritten when the package is updated.Fail2ban reads the configuration files in the following order. Each .local file overrides the settings from the .conf file:/etc/fail2ban/jail.conf/etc/fail2ban/jail.d/*.conf/etc/fail2ban/jail.local/etc/fail2ban/jail.d/*.localFor most users, the easiest way to configure Fail2ban is to copy the jail.conf to jail.local and modify the .local file. More advanced users can build a .local configuration file from scratch. The .local file doesn’t have to include all settings from the corresponding .conf file, only those you want to override.Create a .local configuration file from the default jail.conf file:sudo cp /etc/fail2ban/jail.{conf,local}Then go ahead and edit the jail.local file with the following values:# \"bantime\" is the number of (s)econds/(m)inutes/(h)ours/(d)ays that a host is banned.bantime = 7d# A host is banned if it has generated \"maxretry\" during the last \"findtime\"# (s)econds/(m)inutes/(h)ours/(d)ays.findtime = 1h# \"maxretry\" is the number of failures before a host gets banned within the \"findtime\".maxretry = 6VerificationThen go ahead and restart the Fail2ban service and see if the status is ok.sudo service fail2ban restart &amp;&amp; sudo service fail2ban status" }, { "title": "Linux - Check Services", "url": "/posts/linux-check-services/", "categories": "linux", "tags": "general", "date": "2017-01-20 23:00:00 +0000", "snippet": "This script is to check if a service is running. If not, restarts the service and send an email to a specific recipient.Preparing the scriptFirst of make an executable bash script:touch check_service.shchmod +x check_service.shNow edit the file with the following script: #!/bin/bash #---- edit the following ----# service=\"service_name\" email=\"hello@harryvasanth.com\" #------- stop editing -------# host=`hostname -f` if (( $(ps -ef | grep -v grep | grep $service | wc -l) &gt; 0 )) then echo \"$service is running\" else /etc/init.d/$service restart if (( $(ps -ef | grep -v grep | grep $service | wc -l) &gt; 0 )) then subject=\"$service at $host has been started\" echo \"$service at $host wasn't running and has been started\" | mail -s \"$subject\" $email else subject=\"$service at $host is not running\" echo \"$service at $host is stopped and cannot be started!!!\" | mail -s \"$subject\" $email fi fiSchedulingThe go ahead and create a cron job to run periodically. You can use the following site to quickly configure a cronjob: cron.help.This is an example to run this script every day at 01:00:0 1 * * * /home/harry.vasanth/scripts/check_service.sh" }, { "title": "Proxmox - Remove a Node from PVE Cluster", "url": "/posts/proxmox-remove-pve-cluster-node/", "categories": "proxmox", "tags": "proxmox-ve", "date": "2016-07-11 17:38:43 +0100", "snippet": "IntroductionThese are the steps to remove a node from an existing Proxmox cluster. Warning: This tutorial may only be used if you want to delete permanently a node from an existing Proxmox cluster!Migrate all virtual machinesMigrate all Virtual Machines to another active node. You can use the live migration feature if you have shared storage or offline migration if you only have local storage.Check all active nodesDisplay all active nodes in order to identify the name of the node you want to remove.root@proxmox-node1:~# pvecm nodesMembership information----------------------Nodeid Votes Name1 1 proxmox-node0 (local)2 1 proxmox-node13 1 proxmox-node24 1 proxmox-node3Shutdown nodeShutdown (permanently) the node that you want to remove. Please be careful: This is a permanent removal Never restart the removed node Don’t assign the local IP address of the removed node to a new node Never assign the name of the removed node to a new node Remove node internallyTo remove the node from the proxmox cluster, connect to an active node, for example: proxmox-node1root@proxmox:~# pvecm delnode NodeNameBashCopyExample:root@proxmox-node1:~# pvecm delnode proxmox-node2Remove node from the GUIRemove the removed node from the proxmox GUILog in to an active node, for example: proxmox-node1root@proxmox-node1:~# ls -l /etc/pve/nodes/proxmox-node0 proxmox-node1 proxmox-node2 proxmox-node3All nodes have is own directory (VM’s inventory, for example), the directory /etc/pve/nodes/ is synced between all cluster nodes.The removed node is still visible in GUI until the node directory exists in the directory /etc/pve/nodes/. If you want to remove from Proxmox GUI the node previously deleted, you just need to delete the directory /etc/pve/nodes/NodeName.root@proxmox-node1:~# mv /etc/pve/nodes/NodeName /root/NodeName Warning: Don’t do this unless you understand each step of the process and don’t mind putting the node in a state where you won’t easily be able to re-add it back to a cluster. Also note that after doing this, the containers on the node do not start up automatically, even though their config file says they are supposed to." }, { "title": "Linux - Install WordPress", "url": "/posts/linux-install-wordpress/", "categories": "linux", "tags": "hosting", "date": "2016-05-07 13:37:00 +0100", "snippet": "InstallationLets start by creating MySQL user and a database for WordPress:mysql -u root -pmysql&gt; CREATE DATABASE wordpress DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci;mysql&gt; GRANT ALL ON wordpress.* TO 'wordpressuser'@'localhost' IDENTIFIED BY 'password';mysql&gt; FLUSH PRIVILEGES;mysql&gt; EXIT; Warning: Every MySQL statement must end in a semi-colon (;). Check to make sure this is present if you are running into any issues.Install additional PHP Plugins and restart Apache service:sudo apt updatesudo apt install php-curl php-gd php-mbstring php-xml php-xmlrpc php-soap php-intl php-zipsudo systemctl restart apache2ConfigurationNow let’s enable .htaccess overrides:sudo vim /etc/apache2/sites-available/harryvasanth.com.conf&lt;VirtualHost *:80&gt; # # DocumentRoot: The directory out of which you will serve your # documents. By default, all requests are taken from this directory, but # symbolic links and aliases may be used to point to other locations. # DocumentRoot \"/var/www/harryvasanth.com/htdocs\" ServerName harryvasanth.com ServerAlias www.harryvasanth.com ServerAdmin hello@harryvasanth.com ErrorLog /var/log/apache2/harryvasanth.com-error.log CustomLog /var/log/apache2/harryvasanth.com-access.log combined # This should be changed to whatever you set DocumentRoot to. # &lt;Directory \"/var/www/harryvasanth.com/htdocs\"&gt; # # Possible values for the Options directive are \"None\", \"All\", # or any combination of: # Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews # # Note that \"MultiViews\" must be named *explicitly* --- \"Options All\" # doesn't give it to you. # # The Options directive is both complicated and important. Please see # http://httpd.apache.org/docs-2.0/mod/core.html#options # for more information. # Options Indexes FollowSymLinks MultiViews # # AllowOverride controls what directives may be placed in .htaccess files. # It can be \"All\", \"None\", or any combination of the keywords: # Options FileInfo AuthConfig Limit # AllowOverride All # # Controls who can get stuff from this server. # Order allow,deny Allow from all &lt;/Directory&gt;&lt;/VirtualHost&gt;Download WordPress and extract it to /tmp and do basic preparations:cd /tmp# Download and extract the latest WordPress versioncurl -O https://wordpress.org/latest.tar.gztar xzvf latest.tar.gz# Create .htaccesstouch /tmp/wordpress/.htaccess# Copy sample config to get startedcp /tmp/wordpress/wp-config-sample.php /tmp/wordpress/wp-config.php# Create Upgrade folder for future updatesmkdir /tmp/wordpress/wp-content/upgrade# Move the directory to our hosting directorysudo cp -a /tmp/wordpress/. /var/www/wordpressFix file permission for the WordPress directory:sudo chown -R www-data:www-data /var/www/wordpresssudo find /var/www/wordpress/ -type d -exec chmod 750 {} \\;sudo find /var/www/wordpress/ -type f -exec chmod 640 {} \\;Now let’s start changing change the configurations by generating salted keys:curl -s https://api.wordpress.org/secret-key/1.1/salt/Copy the output. It should look something like this:define('AUTH_KEY', '6y9T&gt;=`^-3NaDywbj,~0,8!/$1m.uvadJ++N;-yoL^8eaSe%V(]VX&lt;2%wxbxgLw&amp;');define('SECURE_AUTH_KEY', 'lz&gt;$g?@!+&lt;gmQJukfRtti#Dkk~;:+?wQY,7K!D30W&amp;=U;]-3}2CS&gt;D8;+~%Kv}v9');define('LOGGED_IN_KEY', 'p}&gt; nuTwbA~%ueeM#LuU7.WzV1[;3VA bo,Pm6s_f$HY^uzqJ6.$Y|bVbZV1jMm3');define('NONCE_KEY', '4oS4i:KwkOz:/$Z)&amp;e]y@7m5B8FR&lt;+zs+do=BmG~d&lt;&lt;EV@NQ:9h-GNnk*k/z77@K');define('AUTH_SALT', '68|hC4*`4x-ehSRF][-(fR5S8-R|sQt]O}Lt(6&amp;DJCU}v5#|]uh:)$iM+)h|?fR~');define('SECURE_AUTH_SALT', 'rW)-xV{c_BeO]x-G!,e$TBE(Fz|)9P0MhV+l/N.&amp;80@O2GC:Fkd(?7Ft;M&lt;;nMH4');define('LOGGED_IN_SALT', 'XU.w FA[A{n#-$T[$+ OTm3gOo+AG`Z`HH&lt;l&amp;|QjTmk)@4v|-I;|SEccx9&gt;ay$&lt;x');define('NONCE_SALT', 'AV_?7B/oX;mq-/,.h_eX-Dl-xm_zbG8.B]ySK~VUyVa&gt;Rbx dNqd!&amp;m-Fez}HiPq');Now copy these values and replace it in the wp-config.php file:sudo vim /var/www/wordpress/wp-config.phpdefine('AUTH_KEY', 'put your unique phrase here');define('SECURE_AUTH_KEY', 'put your unique phrase here');define('LOGGED_IN_KEY', 'put your unique phrase here');define('NONCE_KEY', 'put your unique phrase here');define('AUTH_SALT', 'put your unique phrase here');define('SECURE_AUTH_SALT', 'put your unique phrase here');define('LOGGED_IN_SALT', 'put your unique phrase here');define('NONCE_SALT', 'put your unique phrase here');Delete those lines and paste in the values you copied:define('AUTH_KEY', '6y9T&gt;=`^-3NaDywbj,~0,8!/$1m.uvadJ++N;-yoL^8eaSe%V(]VX&lt;2%wxbxgLw&amp;');define('SECURE_AUTH_KEY', 'lz&gt;$g?@!+&lt;gmQJukfRtti#Dkk~;:+?wQY,7K!D30W&amp;=U;]-3}2CS&gt;D8;+~%Kv}v9');define('LOGGED_IN_KEY', 'p}&gt; nuTwbA~%ueeM#LuU7.WzV1[;3VA bo,Pm6s_f$HY^uzqJ6.$Y|bVbZV1jMm3');define('NONCE_KEY', '4oS4i:KwkOz:/$Z)&amp;e]y@7m5B8FR&lt;+zs+do=BmG~d&lt;&lt;EV@NQ:9h-GNnk*k/z77@K');define('AUTH_SALT', '68|hC4*`4x-ehSRF][-(fR5S8-R|sQt]O}Lt(6&amp;DJCU}v5#|]uh:)$iM+)h|?fR~');define('SECURE_AUTH_SALT', 'rW)-xV{c_BeO]x-G!,e$TBE(Fz|)9P0MhV+l/N.&amp;80@O2GC:Fkd(?7Ft;M&lt;;nMH4');define('LOGGED_IN_SALT', 'XU.w FA[A{n#-$T[$+ OTm3gOo+AG`Z`HH&lt;l&amp;|QjTmk)@4v|-I;|SEccx9&gt;ay$&lt;x');define('NONCE_SALT', 'AV_?7B/oX;mq-/,.h_eX-Dl-xm_zbG8.B]ySK~VUyVa&gt;Rbx dNqd!&amp;m-Fez}HiPq');Now change the MySQL database details:. . .define('DB_NAME', 'wordpress');/** MySQL database username */define('DB_USER', 'wordpressuser');/** MySQL database password */define('DB_PASSWORD', 'password');. . .Then add the following line at the end to prevent WordPress from promting for FTP Server.. . .define('FS_METHOD', 'direct');VerificationFinally visit your using your web browser to finish setting up WordPress:http://harryvasanth.com" }, { "title": "Linux - Install Certbot", "url": "/posts/linux-install-certbot/", "categories": "linux", "tags": "hosting", "date": "2016-04-30 09:39:21 +0100", "snippet": "InstallationInstall Certbot’s Apache package with apt:sudo apt install certbotConfigurationNow use Certbot to obtain the SSL certificate:sudo certbot --apache -d your_domain -d www.your_domainThis runs certbot with the --apache plugin, using -d to specify the domain names you’d like the certificate to be valid for.If that’s successful, certbot will ask how you’d like to configure your HTTPS settings:Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.-------------------------------------------------------------------------------1: No redirect - Make no further changes to the webserver configuration.2: Redirect - Make all requests redirect to secure HTTPS access. Choose this fornew sites, or if you're confident your site works on HTTPS. You can undo thischange by editing your web server's configuration.-------------------------------------------------------------------------------Select the appropriate number [1-2] then [enter] (press 'c' to cancel):Select your choice then hit ENTER. The configuration will be updated, and Apache will reload to pick up the new settings. certbot will wrap up with a message telling you the process was successful and where your certificates are stored:IMPORTANT NOTES: - Congratulations! Your certificate and chain have been saved at: /etc/letsencrypt/live/your_domain/fullchain.pem Your key file has been saved at: /etc/letsencrypt/live/your_domain/privkey.pem Your cert will expire on 2016-07-30. To obtain a new or tweaked version of this certificate in the future, simply run certbot again with the \"certonly\" option. To non-interactively renew *all* of your certificates, run \"certbot renew\" - Your account credentials have been saved in your Certbot configuration directory at /etc/letsencrypt. You should make a secure backup of this folder now. This configuration directory will also contain certificates and private keys obtained by Certbot so making regular backups of this folder is ideal. - If you like Certbot, please consider supporting our work by: Donating to ISRG / Let's Encrypt: https://letsencrypt.org/donate Donating to EFF: https://eff.org/donate-leVerificationFinally lets test the certificate renewal process by doing a dry run with certbot:sudo certbot renew --dry-runIf you see no errors, you’re all set." }, { "title": "Linux - Install phpMyAdmin", "url": "/posts/linux-install-phpmyadmin/", "categories": "linux", "tags": "hosting", "date": "2016-04-23 08:49:01 +0100", "snippet": "InstallationUse apt to install phpMyAdmin and additional complimentary packages:sudo apt updatesudo apt install phpmyadmin php-mbstring php-gettextThis will ask you a few questions in order to configure your installation correctly. Warning: When the prompt appears, apache2 is highlighted, but not selected. If you do not hit SPACE to select Apache, the installer will not move the necessary files during installation. Hit SPACE, TAB, and then ENTER to select Apache. For the server selection, choose apache2 Select Yes when asked whether to use dbconfig-common to set up the database You will then be asked to choose and confirm a MySQL application password for phpMyAdminConfigurationThe installation process adds the phpMyAdmin Apache configuration file into the /etc/apache2/conf-enabled/ directory, where it is read automatically. The only thing you need to do is explicitly enable the mbstring PHP extension, and restart Apache service:sudo phpenmod mbstringsudo systemctl restart apache2Create dedicated user for phpMyAdmin:mysql -u root -pmysql&gt; CREATE USER 'phpmyadmin'@'localhost' IDENTIFIED BY 'password';mysql&gt; GRANT ALL PRIVILEGES ON *.* TO 'phpmyadmin'@'localhost' WITH GRANT OPTION;mysql&gt; exitVerificationYou can now access the web interface by visiting your server’s domain name or public IP address followed by /phpmyadmin:http://your_domain_or_IP/phpmyadmin" }, { "title": "Linux - Install PHP", "url": "/posts/linux-install-php/", "categories": "linux", "tags": "hosting", "date": "2016-04-16 11:09:12 +0100", "snippet": "InstallationUse apt to install PHP. In addition, include some helper packages this time so that PHP code can run under the Apache server and talk to your MySQL database:sudo apt install php libapache2-mod-php php-mysqlInstall PHP Command Line Interface:sudo apt install php-cliConfigurationOpen the dir.conf file to prioritize PHP extensions over standard ones:sudo vim /etc/apache2/mods-available/dir.confIt should look like this:&lt;IfModule mod_dir.c&gt; DirectoryIndex index.php index.html index.cgi index.pl index.xhtml index.htm&lt;/IfModule&gt;Lets restart Apache to apply the changes and also check the status of Apache service:sudo systemctl restart apache2 &amp;&amp; sudo systemctl status apache2● apache2.service - LSB: Apache2 web server Loaded: loaded (/etc/init.d/apache2; bad; vendor preset: enabled) Drop-In: /lib/systemd/system/apache2.service.d └─apache2-systemd.conf Active: active (running) since Tue 2018-04-23 14:28:43 EDT; 45s ago Docs: man:systemd-sysv-generator(8) Process: 13581 ExecStop=/etc/init.d/apache2 stop (code=exited, status=0/SUCCESS) Process: 13605 ExecStart=/etc/init.d/apache2 start (code=exited, status=0/SUCCESS) Tasks: 6 (limit: 512) CGroup: /system.slice/apache2.service ├─13623 /usr/sbin/apache2 -k start ├─13626 /usr/sbin/apache2 -k start ├─13627 /usr/sbin/apache2 -k start ├─13628 /usr/sbin/apache2 -k start ├─13629 /usr/sbin/apache2 -k start └─13630 /usr/sbin/apache2 -k startVerificationNow let’s check if everything is working correctly by creating a PHP file under the web hosting directory we created earlier on the Apache Installation section:sudo vim /var/www/your_domain/phpinfo.phpAdd the following lines to the phpinfo.php:&lt;?phpphpinfo();?&gt;Now we can check the ouput via the browser by going to your domain/ip:http://your_domain/phpinfo.php or http://your_ip/phpinfo.phIf it successful go ahead and remove the file to avoid giving away security information:sudo rm /var/www/your_domain/phpinfo.php" }, { "title": "Linux - Install MySQL", "url": "/posts/linux-install-mysql/", "categories": "linux", "tags": "hosting", "date": "2016-04-09 14:12:44 +0100", "snippet": "InstallationUse apt to install MySQL server:sudo apt install mysql-serversudo mysqlmysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'new_password';Start the interactive script by running:sudo mysql_secure_installationAnswer Y for yes, or anything else to continue without enabling.VALIDATE PASSWORD PLUGIN can be used to test passwordsand improve security. It checks the strength of passwordand allows the users to set only those passwords which aresecure enough. Would you like to setup VALIDATE PASSWORD plugin?Press y|Y for Yes, any other key for No:Choose the option 1 MEDIUM:There are three levels of password validation policy:LOW Length &gt;= 8MEDIUM Length &gt;= 8, numeric, mixed case, and special charactersSTRONG Length &gt;= 8, numeric, mixed case, special characters and dictionary filePlease enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 1Using existing password for root.Estimated strength of the password: 100Change the password for root ? ((Press y|Y for Yes, any other key for No) : nFor the rest of the questions, press Y and hit the ENTER key at each prompt. This will remove some anonymous users and the test database, disable remote root logins, and load these new rules so that MySQL immediately respects the changes you have made.ConfigurationLet’s change the authentication method from auth_socket to mysql_native_password. To do this, open up the MySQL prompt from your terminal and check which authentication method each of your MySQL user accounts uses:sudo mysqlmysql&gt; SELECT user,authentication_string,plugin,host FROM mysql.user;The output should look like this:+------------------+-------------------------------------------+-----------------------+-----------+| user | authentication_string | plugin | host |+------------------+-------------------------------------------+-----------------------+-----------+| root | | auth_socket | localhost || mysql.session | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost || mysql.sys | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost || debian-sys-maint | *CC744277A401A7D25BE1CA89AFF17BF607F876FF | mysql_native_password | localhost |+------------------+-------------------------------------------+-----------------------+-----------+4 rows in set (0.00 sec)To configure the root account to authenticate with a password, run the following ALTER USER command. Be sure to change password to a strong password of your choosing and then run FLUSH PRIVILEGES which tells the server to reload the grant tables and put your new changes into effect:mysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';mysql&gt; FLUSH PRIVILEGES;VerificationNow when you check which authentication method each of your MySQL user accounts uses the output should be something like this:mysql&gt; SELECT user,authentication_string,plugin,host FROM mysql.user;+------------------+-------------------------------------------+-----------------------+-----------+| user | authentication_string | plugin | host |+------------------+-------------------------------------------+-----------------------+-----------+| root | *3636DACC8616D997782ADD0839F92C1571D6D78F | mysql_native_password | localhost || mysql.session | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost || mysql.sys | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost || debian-sys-maint | *CC744277A401A7D25BE1CA89AFF17BF607F876FF | mysql_native_password | localhost |+------------------+-------------------------------------------+-----------------------+-----------+4 rows in set (0.00 sec)mysql&gt; exit" }, { "title": "Linux - Install Apache", "url": "/posts/linux-install-apache/", "categories": "linux", "tags": "hosting", "date": "2016-04-01 02:32:03 +0100", "snippet": "InstallationInstall Apache using Ubuntu’s package manager using apt:sudo apt updatesudo apt install apache2Check and adjust the Firewall rules to allow all web traffic to Apache using ufw:sudo ufw allow in \"Apache Full\"When you check your server’s IP on the browser, you should see a default landing page of Apache.ConfigurationNow lets start setting virtual hosts:sudo mkdir /var/www/your_domainsudo chown -R www-data:www-data /var/www/your_domainsudo chmod -R 755 /var/www/your_domainLet’s create simple HTML page:sudo vim /var/www/your_domain/index.html&lt;html&gt; &lt;head&gt; &lt;title&gt;Welcome to Your_domain!&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Success! The your_domain server block is working!&lt;/h1&gt; &lt;/body&gt;&lt;/html&gt;Now let’s create a new virtual host file under Apache’s available sites:sudo vim /etc/apache2/sites-available/your_domain.conf&lt;VirtualHost *:80&gt; ServerAdmin webmaster@localhost ServerName your_domain ServerAlias www.your_domain DocumentRoot /var/www/your_domain ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined&lt;/VirtualHost&gt;Let’s enable out host file and disable the default Apache landing page:sudo a2ensite your_domain.confsudo a2dissite 000-default.confVerificationNow we can check if the configurations are working properly and restart Apache service for changes to take effect:sudo apache2ctl configtest Syntax OKsudo systemctl restart apache2Finally, when you check your server’s IP on the browser, you should see “The your_domain server block is working!”." }, { "title": "Proxmox - Increase VM Disk Size", "url": "/posts/proxmox-increase-disk-size/", "categories": "proxmox", "tags": "proxmox-ve", "date": "2016-03-31 12:11:15 +0100", "snippet": "StepsThese are the steps to increase the disk size of the VMs in Proxmox Add new disk in Proxmox VE UI Partition the new disk Create a new physical device (using pvcreate) Extend the existing volume group Extend the logical volume Extend the file system (ext4 in my case)Check current storageFirst lets check how much space left on the VM:root@jupyterhub:~# df -hFilesystem Size Used Avail Use% Mounted onudev 2.0G 0 2.0G 0% /devtmpfs 396M 11M 385M 3% /run/dev/mapper/ubuntu1604--vg-root 18G 15G 1.8G 90% /tmpfs 2.0G 4.0K 2.0G 1% /dev/shmtmpfs 5.0M 0 5.0M 0% /run/locktmpfs 2.0G 0 2.0G 0% /sys/fs/cgroup/dev/mapper/ubuntu1604--vg-home 20G 44M 19G 1% /home/jupyter/dev/mapper/ubuntu1604--vg-log 465M 112M 325M 26% /var/log/dev/sda1 472M 155M 293M 35% /boottmpfs 396M 0 396M 0% /run/user/2160Now lets see all the available disks on the system after adding a new disk through Promox VE User Interface:root@testvm:~# fdisk -lDisk /dev/sda: 10 GiB, 10737418240 bytes, 20971520 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisklabel type: dosDisk identifier: 0x93152316Device Boot Start End Sectors Size Id Type/dev/sda1 * 2048 999423 997376 487M 83 Linux/dev/sda2 1001470 20969471 19968002 9.5G 5 Extended/dev/sda5 1001472 20969471 19968000 9.5G 8e Linux LVMDisk /dev/sdb: 64 GiB, 68719476736 bytes, 134217728 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisk /dev/sdc: 32 GiB, 34359738368 bytes, 67108864 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisklabel type: gptDisk identifier: 6B4A0899-D3D5-4771-856D-EDB254829C91Device Start End Sectors Size Type/dev/sdc1 2048 67108830 67106783 32G Linux filesystemDisk /dev/mapper/ubuntu1604--vg-root: 17.5 GiB, 18815647744 bytes, 36749312 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisk /dev/mapper/ubuntu1604--vg-swap: 952 MiB, 998244352 bytes, 1949696 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisk /dev/mapper/ubuntu1604--vg-log: 488 MiB, 511705088 bytes, 999424 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisk /dev/mapper/ubuntu1604--vg-home: 20 GiB, 21474836480 bytes, 41943040 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesPartitioning the new diskAs you can see the 64 GiB disk is present without any partitioning. Lets go ahead and partition that disk:root@testvm:~# fdisk /dev/sdbWelcome to fdisk (util-linux 2.27.1).Changes will remain in memory only, until you decide to write them.Be careful before using the write command.Device does not contain a recognized partition table.Created a new DOS disklabel with disk identifier 0x193c65a1.Command (m for help): nPartition type p primary (0 primary, 0 extended, 4 free) e extended (container for logical partitions)Select (default p): pPartition number (1-4, default 1): 1First sector (2048-134217727, default 2048):Last sector, +sectors or +size{K,M,G,T,P} (2048-134217727, default 134217727):Created a new partition 1 of type 'Linux' and of size 64 GiB.Command (m for help): pDisk /dev/sdb: 64 GiB, 68719476736 bytes, 134217728 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisklabel type: dosDisk identifier: 0x193c65a1Device Boot Start End Sectors Size Id Type/dev/sdb1 2048 134217727 134215680 64G 83 LinuxCommand (m for help): pDisk /dev/sdb: 64 GiB, 68719476736 bytes, 134217728 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisklabel type: dosDisk identifier: 0x193c65a1Device Boot Start End Sectors Size Id Type/dev/sdb1 2048 134217727 134215680 64G 83 LinuxCommand (m for help): wThe partition table has been altered.Calling ioctl() to re-read partition table.Syncing disks.Now let’s create a new physical device with the newly partitioned disk using pvcreate and view it using pvdisplay:root@testvm:~# pvcreate /dev/sdb1 Physical volume \"/dev/sdb1\" successfully createdroot@jupyterhub:~# pvdisplay --- Physical volume --- PV Name /dev/sda5 VG Name ubuntu1604-vg PV Size 9.52 GiB / not usable 2.00 MiB Allocatable yes (but full) PE Size 4.00 MiB Total PE 2437 Free PE 0 Allocated PE 2437 PV UUID qNCelA-nJDf-NX7Q-ZkK4-iR4M-vQho-mfFqA1 --- Physical volume --- PV Name /dev/sdc1 VG Name ubuntu1604-vg PV Size 32.00 GiB / not usable 2.98 MiB Allocatable yes PE Size 4.00 MiB Total PE 8191 Free PE 662 Allocated PE 7529 PV UUID fu3bxw-oCCH-jOh1-428b-lAQf-DCBe-E6KQiv \"/dev/sdb1\" is a new physical volume of \"64.00 GiB\" --- NEW Physical volume --- PV Name /dev/sdb1 VG Name PV Size 64.00 GiB Allocatable NO PE Size 0 Total PE 0 Free PE 0 Allocated PE 0 PV UUID F0FsRP-ROTm-xbMv-7I3D-E0Jh-mfBw-rM4mn4Check current volume groupThereafter, let’s go ahead and check the current volume groups using vgdisplay:root@testvm:~# vgdisplay --- Volume group --- VG Name ubuntu1604-vg System ID Format lvm2 Metadata Areas 2 Metadata Sequence No 12 VG Access read/write VG Status resizable MAX LV 0 Cur LV 4 Open LV 4 Max PV 0 Cur PV 2 Act PV 2 VG Size 41.52 GiB PE Size 4.00 MiB Total PE 10628 Alloc PE / Size 9966 / 38.93 GiB Free PE / Size 662 / 2.59 GiB VG UUID BR84gF-JBKN-ndcp-At3G-l9UB-4CAs-KVyytaExtend current volume groupNow we can extend it using vgextend and verify it using vgdisplay:root@testvm:~# vgextend ubuntu1604-vg /dev/sdb1 Volume group \"ubuntu1604-vg\" successfully extendedroot@testvm:~# vgdisplay --- Volume group --- VG Name ubuntu1604-vg System ID Format lvm2 Metadata Areas 3 Metadata Sequence No 13 VG Access read/write VG Status resizable MAX LV 0 Cur LV 4 Open LV 4 Max PV 0 Cur PV 3 Act PV 3 VG Size 105.51 GiB PE Size 4.00 MiB Total PE 27011 Alloc PE / Size 9966 / 38.93 GiB Free PE / Size 17045 / 66.58 GiB VG UUID BR84gF-JBKN-ndcp-At3G-l9UB-4CAs-KVyytaThereafter, lets go ahead and check the logical volumes using lvdisplay:root@testvm:~# lvdisplay --- Logical volume --- LV Path /dev/ubuntu1604-vg/swap LV Name swap VG Name ubuntu1604-vg LV UUID 0SYO9N-bAdU-vfGR-soF1-vvcp-Bg8v-EPrJEL LV Write Access read/write LV Creation host, time ubuntu1604, 2017-06-27 15:12:58 +0100 LV Status available # open 2 LV Size 952.00 MiB Current LE 238 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 252:1 --- Logical volume --- LV Path /dev/ubuntu1604-vg/log LV Name log VG Name ubuntu1604-vg LV UUID fXp0kR-TYBp-mdiS-sYXd-ja2S-dABf-ThjEf0 LV Write Access read/write LV Creation host, time ubuntu1604, 2017-06-27 15:13:14 +0100 LV Status available # open 1 LV Size 488.00 MiB Current LE 122 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 252:2 --- Logical volume --- LV Path /dev/ubuntu1604-vg/root LV Name root VG Name ubuntu1604-vg LV UUID WwteZj-vPhz-3iNC-26Dg-Ju36-o6xe-75WRto LV Write Access read/write LV Creation host, time ubuntu1604, 2017-06-27 15:13:50 +0100 LV Status available # open 1 LV Size 17.52 GiB Current LE 4486 Segments 2 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 252:0 --- Logical volume --- LV Path /dev/ubuntu1604-vg/home LV Name home VG Name ubuntu1604-vg LV UUID OQHBcC-aEeD-ePLq-ezMU-3OgV-JPyn-2yarKe LV Write Access read/write LV Creation host, time ubuntu1604, 2017-09-27 12:16:53 +0100 LV Status available # open 1 LV Size 20.00 GiB Current LE 5120 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 252:3Extend the root volumeLets extend the root volume by 10 GiB using lvextend:root@testvm:~# lvextend --resizefs -L+10G /dev/ubuntu1604-vg/root Size of logical volume ubuntu1604-vg/root changed from 22.52 GiB (5766 extents) to 32.52 GiB (8326 extents). Logical volume root successfully resized.resize2fs 1.42.13 (17-May-2015)Filesystem at /dev/mapper/ubuntu1604--vg-root is mounted on /; on-line resizing requiredold_desc_blocks = 2, new_desc_blocks = 3The filesystem on /dev/mapper/ubuntu1604--vg-root is now 8525824 (4k) blocks long.Allocate entire disk space to the volumeIn case we want the entire disk space to extended you can simply assign 100% of the free space.root@testvm:~# lvextend --resizefs -l +100%FREE /dev/ubuntu1604-vg/root" }, { "title": "Proxmox - Cluster Status", "url": "/posts/proxmox-pve-cluster-status/", "categories": "proxmox", "tags": "proxmox-ve", "date": "2016-01-21 14:24:03 +0000", "snippet": "Check Proxmox VE cluster statusThis command will let you know the current status of Proxmox VE Cluster:root@pve:~# pvecm statusQuorum information------------------Date: Fri Jun 23 14:54:18 2017Quorum provider: corosync_votequorumNodes: 2Node ID: 0x00000002Ring ID: 1/32Quorate: YesVotequorum information----------------------Expected votes: 2Highest expected: 2Total votes: 2Quorum: 2 Flags: Quorate Membership information---------------------- Nodeid Votes Name0x00000001 1 192.168.10.260x00000002 1 192.168.10.68 (local)Fix unresponsive Proxmox VE clusterIf a Proxmox node in the PVE cluster shows the unknown status (greyed out with ?) as well as all the VMs of that node. We can restart the following services of that particular node through CLI to reload the node and its GUI elements.sudo service pvestatd restart &amp;&amp; sudo service pvedaemon restart &amp;&amp; sudo service pveproxy restart" }, { "title": "Proxmox - Resize PVE Root", "url": "/posts/proxmox-resize-pve-root/", "categories": "proxmox", "tags": "proxmox-ve", "date": "2016-01-21 14:24:03 +0000", "snippet": "Why?When installing proxmox from iso its give a lot storage to pve-data which is a volume-storage and not a lot for pve-root, and pve-root it’s where your filesystem is mounted.Check current storageFirst of all, lets check how much we have in all of our volume-storage:lvdisplayThe output should be something like this:root@pve:~# lvdisplay --- Logical volume --- LV Path /dev/pve/swap LV Name swap VG Name pve LV UUID niOT4X-rcyP-dKCD-sqAK-SWxy-dto9-vlbNjj LV Write Access read/write LV Creation host, time proxmox, 2020-05-04 10:39:46 +0300 LV Status available # open 2 LV Size 7.00 GiB Current LE 1792 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253:0 --- Logical volume --- LV Path /dev/pve/root LV Name root VG Name pve LV UUID OrPb0H-h1lm-OzZ8-C02y-6FHy-RAuV-ppfrQp LV Write Access read/write LV Creation host, time proxmox, 2020-05-04 10:39:46 +0300 LV Status available # open 1 LV Size 14.75 GiB Current LE 3776 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253:1 --- Logical volume --- LV Name data VG Name pve LV UUID 3O0Z5M-uV0c-tCXH-8Sz0-XZrk-2rZY-qQkvuR LV Write Access read/write LV Creation host, time proxmox, 2020-05-04 10:39:46 +0300 LV Pool metadata data_tmeta LV Pool data data_tdata LV Status available # open 0 LV Size 28.37 GiB Allocated pool data 0.00% Allocated metadata 0.02% Current LE 7263 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253:4As we can see there is 28.37 GiB in pve-data and only 14.75 GiB in pve-root.ResizeFor example, if we want to resize our pve-data to be 10 GiB and also give pve-root the rest of the space, we can do it by do it as follows:# remove pve-data logical volume.lvremove /dev/pve/data -y# create it again with new size.lvcreate -L 10G -n data pve -T# give pve-root all the other size.lvresize -l +100%FREE /dev/pve/root# resize pve-root file systemresize2fs /dev/mapper/pve-rootVerfiyNow you can check the new resized values by using:lvdisplay" } ]
